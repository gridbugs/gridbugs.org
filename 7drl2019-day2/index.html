<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="gridbugs">
    <meta property="og:type" content="website">

    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
	<meta property="og:type" content="article">
	<meta property="og:title" content="7 Day Roguelike 2019: Physics and Improved Pathfinding">
	<link rel="canonical" href="https://gridbugs.github.io/gridbugs.org/7drl2019-day2/">
	<meta property="og:url" content="https://gridbugs.github.io/gridbugs.org/7drl2019-day2/">

	

	
	    <meta property="article:published_time" content="2019-03-04T22:00:00+10:00">
	

	
	    <meta property="og:image" content="https://gridbugs.github.io/gridbugs.org/logo.png">
	
    

    <link rel="icon" type="image/x-icon" href="https://gridbugs.github.io/gridbugs.org/favicon.png">
    <link rel="alternate" type="application/rss+xml" title="gridbugs" href="https://gridbugs.github.io/gridbugs.org/rss.xml">
    <link rel="alternate" type="application/atom+xml" title="gridbugs" href="https://gridbugs.github.io/gridbugs.org/atom.xml">

    <link rel="stylesheet" href="https://gridbugs.github.io/gridbugs.org/style.css">
    <title>
7 Day Roguelike 2019: Physics and Improved Pathfinding
</title>
  </head>
  <body>
    <div id="content">
      <header>
  <div class="header-nav-container">
    <nav>
      <ul>
	<li class="lhs"><a href="https://gridbugs.github.io/gridbugs.org">gridbugs</a></li>
	
	
	
	<li class="lhs slash-before"><a href="https://gridbugs.github.io/gridbugs.org/devlogs/">devlogs</a></li>
	
	
	<li class="first-rhs rhs"><a href="https://gridbugs.github.io/gridbugs.org/about">about</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/tags">tags</a></li>
      </ul>
    </nav>
  </div>
</header>

      




<div class="next-prev-nav-container">
  <nav>
    <ul>
      
      
      
      
      <li class="nav-prev">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;7drl2019-day1&#x2F;" aria-label="Previous">
	  Previous: 7 Day Roguelike 2019: Procgen and Basic Pathfinding
	</a>
	
      </li>
      <li class="nav-next">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;7drl2019-day3&#x2F;" aria-label="Next">
	  Next: 7 Day Roguelike 2019: Card Display, Death Screen
	</a>
	
      </li>
    </ul>
  </nav>
</div>



<article>
<h1 class="title">7 Day Roguelike 2019: Physics and Improved Pathfinding</h1>

  
<p class="post-meta">
  <time datetime="2019-03-04T22:00:00+10:00">
    March 04, 2019
  </time>
  
</p>


  

<p>The most notable feature from tonight is NPCs pre-commit
to an action before the player takes their turn. This
means the game can telegraph enemy actions to the player,
which lets the player better plan ahead in combat.</p>
<p><img src="https://gridbugs.github.io/gridbugs.org/7drl2019-day2/a.png" alt="a.png" /></p>
<p>When an NPC is choosing where to move, it will avoid cells
which either currently contain an NPC, or which an NPC has
already committed to moving into. This does mean NPCs will tend
to be more spread out.</p>
<span id="continue-reading"></span>
<p>NPCs now only act if they have line of sight
to the player, but they do have a higher vision distance than the player,
so they can still walk into your visible area. This is a cheap way to
prevent NPCs pathing towards the player from the other side of the map.</p>
<h2 id="physics"><a class="zola-anchor" href="#physics" aria-label="Anchor link for: physics">Physics</a></h2>
<p>The player can no longer walk through walls or NPCs. There is basic bump
combat, but no damage system yet. I made an animation system so you can see
when take and deal damage without the need for a message log.</p>
<h2 id="end-of-day-video"><a class="zola-anchor" href="#end-of-day-video" aria-label="Anchor link for: end-of-day-video">End of day video</a></h2>
<video autoplay muted loop>
  <source src="eod.mp4" type="video/mp4">
  Your browser does not support the video element.
</video>
<h2 id="wishlist"><a class="zola-anchor" href="#wishlist" aria-label="Anchor link for: wishlist">Wishlist</a></h2>
<p>I’m going to maintain a wishlist for the remainder of the week, and turn it into
a todo list after the 7drl.</p>
<ul>
<li>Split up grid-search into smaller libraries. The current library tries to be too much
and it makes it harder to use. Specifically I want a richer distance map library
and a dedicated library for Jump Point Search (a flavour of A*). These should cover all my
pathfinding needs.</li>
<li>Querying a WFC input image for all the pattern ids containing a certain colour.
Generating terrain often requires restricting the level boundary from appearing in the
middle of the level, and it’s currently clunky to enumerate (by hand) enough of the relevant
pattern ids to forbid from the centre.</li>
<li>A standalone WFC binary which can be built with optimisations, and an interface for non-optimised
programs to invoke it.</li>
<li>Frequently I want a grid of values which I effectively clear and re-populate on each frame/turn.
Rather than actually clearing each cell, I maintain a frame/turn count, and store in each cell,
the last frame/turn on which it was updated. If a cell’s count is different from the current frame/turn
count, the cell is treated as empty. It might be worth generalising this and putting it in its own
library.</li>
<li>The glutin frontend of prototty does weird things when you open a window on one monitor, and then
move the window to a different monitor. It looks like the foreground and background of tiles gets
out of sync.</li>
</ul>

</article>


<div class="next-prev-nav-container">
  <nav>
    <ul>
      
      
      
      
      <li class="nav-prev">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;7drl2019-day1&#x2F;" aria-label="Previous">
	  Previous: 7 Day Roguelike 2019: Procgen and Basic Pathfinding
	</a>
	
      </li>
      <li class="nav-next">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;7drl2019-day3&#x2F;" aria-label="Next">
	  Next: 7 Day Roguelike 2019: Card Display, Death Screen
	</a>
	
      </li>
    </ul>
  </nav>
</div>



      <footer>
  <div class="footer-nav-container">
    <nav>
      <ul>
	<li><a href="https://github.com/gridbugs">github</a></li>
	<li><a href="https://gridbugs.itch.io">itch.io</a></li>
	<li><a href="https://hachyderm.io/@gridbugs">mastodon</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/blog">Blog</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/projects">Projects</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/devlogs">Devlogs</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/about">About</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/contact">Contact</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/external">External</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/tags">Tags</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/atom.xml">Atom</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/rss.xml">RSS</a></li>
      </ul>
    </nav>
  </div>
  <ul class="copyright">
    <li>
      Built with <a href="https://www.getzola.org/">Zola</a>.
    </li>
    <li>
      © 2015-2026 Stephen Sherratt.
    </li>
  </ul>
</footer>

    </div>
  </body>
</html>
