<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="gridbugs">
    <meta property="og:type" content="website">

    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
	<meta property="og:type" content="article">
	<meta property="og:title" content="Disk image tool progress - Counter-intuitive header population">
	<link rel="canonical" href="https://gridbugs.github.io/gridbugs.org/daily/disk-image-tool-progress-counter-intuitive-header-population/">
	<meta property="og:url" content="https://gridbugs.github.io/gridbugs.org/daily/disk-image-tool-progress-counter-intuitive-header-population/">

	

	
	    <meta property="article:published_time" content="2020-11-13T00:00:00+00:00">
	

	
	    <meta property="og:image" content="https://gridbugs.github.io/gridbugs.org/logo.png">
	
    

    <link rel="icon" type="image/x-icon" href="https://gridbugs.github.io/gridbugs.org/favicon.png">
    <link rel="alternate" type="application/rss+xml" title="gridbugs" href="https://gridbugs.github.io/gridbugs.org/rss.xml">
    <link rel="alternate" type="application/atom+xml" title="gridbugs" href="https://gridbugs.github.io/gridbugs.org/atom.xml">

    <link rel="stylesheet" href="https://gridbugs.github.io/gridbugs.org/style.css">
    <title>
Disk image tool progress - Counter-intuitive header population
</title>
  </head>
  <body>
    <div id="content">
      <header>
  <div class="header-nav-container">
    <nav>
      <ul>
	<li class="lhs"><a href="https://gridbugs.github.io/gridbugs.org">gridbugs</a></li>
	
	
	
	<li class="lhs slash-before"><a href="https://gridbugs.github.io/gridbugs.org/daily/">daily posts</a></li>
	
	
	<li class="first-rhs rhs"><a href="https://gridbugs.github.io/gridbugs.org/about">about</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/tags">tags</a></li>
      </ul>
    </nav>
  </div>
</header>

      




<div class="next-prev-nav-container">
  <nav>
    <ul>
      
      
      
      
      <li class="nav-prev">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;daily&#x2F;disk-image-tool-progress-directory-hierarchies&#x2F;" aria-label="Previous">
	  Previous: Disk image tool progress - directory hierarchies
	</a>
	
      </li>
      <li class="nav-next">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;daily&#x2F;stopping-daily-posts&#x2F;" aria-label="Next">
	  Next: Stopping daily posts
	</a>
	
      </li>
    </ul>
  </nav>
</div>



<article>
<h1 class="title">Disk image tool progress - Counter-intuitive header population</h1>

  
<p class="post-meta">
  <time datetime="2020-11-13T00:00:00+00:00">
    November 13, 2020
  </time>
  
</p>


  

<p>While preparing to implement a disk image creation tool I built a few tools for
reading files from inside disk images. In the process I wrote some code for
parsing the various disk and partition header structures present in a disk
image.  Now that I’m actually generating images of my own, I need to populate
headers in the images.</p>
<p>The most obvious way to do this is to populate the fields of the same header
type that I previously parsed from disk images when reading files from them,
and then have some additional code for serializing the header type into the
disk image in whatever format the GPT or FAT protocols expect.</p>
<p>After going a little way down this path I stopped and tried an alternative,
where I write header information directly in its serialized form to a buffer,
and then parse it back out with my existing header parsers, purely as a sanity
check. There are two benefits to this approach.  The first is the sanity check</p>
<ul>
<li>I’ve tested the header parsing code on real disk images and have some degree
of confidence that it works. In addition to parsing values from disk headers,
it also performs some validation, such as checking checksums.  Writing the disk
header directly and parsing it back means I can check that the header I’m
writing to disk is valid.</li>
</ul>
<p>The second benefit is less code. Were I to populate a struct with header
fields, and then serialize it, I’d have 3 places where each field is listed out
in the code - parsing headers, populating header structs, and serializing
header structs. As it is now, there are only two - parsing headers, and writing
header fields.</p>

</article>


<div class="next-prev-nav-container">
  <nav>
    <ul>
      
      
      
      
      <li class="nav-prev">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;daily&#x2F;disk-image-tool-progress-directory-hierarchies&#x2F;" aria-label="Previous">
	  Previous: Disk image tool progress - directory hierarchies
	</a>
	
      </li>
      <li class="nav-next">
	
	<a href="https:&#x2F;&#x2F;gridbugs.github.io&#x2F;gridbugs.org&#x2F;daily&#x2F;stopping-daily-posts&#x2F;" aria-label="Next">
	  Next: Stopping daily posts
	</a>
	
      </li>
    </ul>
  </nav>
</div>



      <footer>
  <div class="footer-nav-container">
    <nav>
      <ul>
	<li><a href="https://github.com/gridbugs">github</a></li>
	<li><a href="https://gridbugs.itch.io">itch.io</a></li>
	<li><a href="https://hachyderm.io/@gridbugs">mastodon</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/blog">Blog</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/projects">Projects</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/devlogs">Devlogs</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/about">About</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/contact">Contact</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/external">External</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/tags">Tags</a></li>
      </ul>
    </nav>
    <nav>
      <ul>
	<li><a href="https://gridbugs.github.io/gridbugs.org/atom.xml">Atom</a></li>
	<li><a href="https://gridbugs.github.io/gridbugs.org/rss.xml">RSS</a></li>
      </ul>
    </nav>
  </div>
  <ul class="copyright">
    <li>
      Built with <a href="https://www.getzola.org/">Zola</a>.
    </li>
    <li>
      © 2015-2025 Stephen Sherratt.
    </li>
  </ul>
</footer>

    </div>
  </body>
</html>
